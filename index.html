<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∏ Akort Aleti</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
        .container {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #ff5252;
            transform: scale(1.05);
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        .instrument-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        .instrument-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .instrument-btn.active {
            background: #ff6b6b;
            border-color: #ff5252;
            transform: scale(1.1);
        }
        .tuning-display {
            font-size: 20px;
            margin: 15px 0;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            font-weight: bold;
        }
        .status.ready {
            background: rgba(46, 204, 113, 0.3);
            border: 2px solid #2ecc71;
        }
        .status.error {
            background: rgba(231, 76, 60, 0.3);
            border: 2px solid #e74c3c;
        }
        .status.waiting {
            background: rgba(241, 196, 15, 0.3);
            border: 2px solid #f1c40f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∏ AKORT ALETƒ∞</h1>
        <p>Enstr√ºmanƒ±nƒ± se√ß ve akort et!</p>
        
        <!-- ENSTR√úMAN SE√áƒ∞Mƒ∞ -->
        <div class="instrument-buttons">
            <div class="instrument-btn active" onclick="selectInstrument('guitar')">üé∏ Gitar</div>
            <div class="instrument-btn" onclick="selectInstrument('piano')">üéπ Piyano</div>
            <div class="instrument-btn" onclick="selectInstrument('violin')">üéª Keman</div>
            <div class="instrument-btn" onclick="selectInstrument('saz')">üéµ Baƒülama</div>
            <div class="instrument-btn" onclick="selectInstrument('ukulele')">üé∂ Ukulele</div>
        </div>
        
        <!-- DURUM G√ñSTERGESƒ∞ -->
        <div class="status waiting" id="status">
            üé§ Mikrofon eri≈üimi bekleniyor...
        </div>
        
        <button id="startBtn" onclick="startListening()">üé§ Mikrofonu Ba≈ülat</button>
        <button id="stopBtn" onclick="stopListening()" disabled>‚èπÔ∏è Durdur</button>
        
        <!-- AKORT Bƒ∞LGƒ∞Sƒ∞ -->
        <div class="tuning-display">
            <div id="pitchDisplay">Ses Seviyesi: ---</div>
            <div id="noteDisplay">Tahmini Nota: ---</div>
            <div id="frequencyDisplay">Frekans: --- Hz</div>
            <div id="instrumentInfo">Enstr√ºman: üé∏ Gitar</div>
            <div id="tuningInfo">Akort: E A D G B E</div>
        </div>

        <!-- SES G√ñSTERGESƒ∞ -->
        <div style="margin: 20px 0;">
            <div style="background: rgba(0,0,0,0.3); height: 20px; border-radius: 10px; overflow: hidden;">
                <div id="volumeBar" style="height: 100%; background: #2ecc71; width: 0%; transition: width 0.1s;"></div>
            </div>
            <div style="margin-top: 5px; font-size: 0.9em;">Ses Seviyesi</div>
        </div>

        <div style="margin-top: 30px;">
            <h3>üéØ √ñzellikler:</h3>
            <p>‚úÖ Ger√ßek zamanlƒ± ses analizi</p>
            <p>‚úÖ Modern AudioWorklet teknolojisi</p>
            <p>‚úÖ Mobil uyumlu</p>
            <p>‚úÖ Tamamen √ºcretsiz</p>
        </div>
    </div>

    <script>
        // DEƒûƒ∞≈ûKENLER
        let audioContext = null;
        let analyser = null;
        let microphone = null;
        let javascriptNode = null;
        let isListening = false;
        let currentInstrument = 'guitar';
        
        // ENSTR√úMAN Bƒ∞LGƒ∞LERƒ∞
        const instrumentData = {
            guitar: {
                name: "üé∏ Gitar",
                tuning: "E A D G B E",
                details: "Kalƒ±ndan inceye: E (6) - A (5) - D (4) - G (3) - B (2) - E (1)"
            },
            piano: {
                name: "üéπ Piyano", 
                tuning: "A4 = 440Hz (La)",
                details: "Standart akort: A4 notasƒ±nƒ±n frekansƒ± 440 Hz"
            },
            violin: {
                name: "üéª Keman",
                tuning: "G D A E",
                details: "Kalƒ±ndan inceye: G (4) - D (3) - A (2) - E (1)"
            },
            saz: {
                name: "üéµ Baƒülama",
                tuning: "La Re Sol",
                details: "Alt tel: La (A), Orta tel: Re (D), √úst tel: Sol (G)"
            },
            ukulele: {
                name: "üé∂ Ukulele", 
                tuning: "G C E A",
                details: "Kalƒ±ndan inceye: G (4) - C (3) - E (2) - A (1)"
            }
        };
        
        // ENSTR√úMAN SE√áƒ∞Mƒ∞
        function selectInstrument(instrument) {
            currentInstrument = instrument;
            
            // Butonlarƒ± g√ºncelle
            document.querySelectorAll('.instrument-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Enstr√ºman bilgilerini g√ºncelle
            const data = instrumentData[instrument];
            document.getElementById('instrumentInfo').textContent = `Enstr√ºman: ${data.name}`;
            document.getElementById('tuningInfo').textContent = `Akort: ${data.tuning}`;
        }
        
        // Mƒ∞KROFONU BA≈ûLAT
        async function startListening() {
            try {
                updateStatus('waiting', 'üé§ Mikrofon eri≈üimi isteniyor...');
                
                // Mikrofon eri≈üim izni
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    } 
                });
                
                updateStatus('ready', '‚úÖ Mikrofon baƒülandƒ±! Ses analizi ba≈üladƒ±.');
                
                // AudioContext olu≈ütur
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                
                // Analyser ayarlarƒ±
                analyser.fftSize = 2048;
                analyser.smoothingTimeConstant = 0.8;
                
                // Baƒülantƒ±larƒ± kur
                microphone.connect(analyser);
                
                // Buton durumlarƒ±nƒ± g√ºncelle
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                isListening = true;
                
                // Ses analizini ba≈ülat
                analyzeSound();
                
            } catch (error) {
                console.error('Mikrofon hatasƒ±:', error);
                updateStatus('error', `‚ùå Mikrofon hatasƒ±: ${error.message}`);
            }
        }
        
        // Mƒ∞KROFONU DURDUR
        function stopListening() {
            if (microphone && audioContext) {
                microphone.disconnect();
                if (audioContext.state !== 'closed') {
                    audioContext.close();
                }
            }
            
            isListening = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            
            updateStatus('waiting', 'üé§ Mikrofon durduruldu. Tekrar ba≈ülatmak i√ßin butona tƒ±kla.');
            document.getElementById('volumeBar').style.width = '0%';
            document.getElementById('pitchDisplay').textContent = 'Ses Seviyesi: ---';
            document.getElementById('noteDisplay').textContent = 'Tahmini Nota: ---';
            document.getElementById('frequencyDisplay').textContent = 'Frekans: --- Hz';
        }
        
        // SES ANALƒ∞Zƒ∞
        function analyzeSound() {
            if (!isListening || !analyser) return;
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            
            function processAudio() {
                if (!isListening) return;
                
                // Frekans verilerini al
                analyser.getByteFrequencyData(dataArray);
                
                // Ses seviyesini hesapla
                let sum = 0;
                for (let i = 0; i < bufferLength; i++) {
                    sum += dataArray[i];
                }
                const average = sum / bufferLength;
                const volume = Math.round(average);
                
                // Ses seviyesi √ßubuƒüunu g√ºncelle
                const volumePercent = Math.min(100, (volume / 255) * 100);
                document.getElementById('volumeBar').style.width = volumePercent + '%';
                
                // Temel perde tespiti (basit algoritma)
                let maxVolume = 0;
                let maxIndex = 0;
                
                for (let i = 0; i < bufferLength; i++) {
                    if (dataArray[i] > maxVolume) {
                        maxVolume = dataArray[i];
                        maxIndex = i;
                    }
                }
                
                // Frekans hesapla
                const frequency = maxIndex * audioContext.sampleRate / analyser.fftSize;
                
                // Ekranƒ± g√ºncelle
                document.getElementById('pitchDisplay').textContent = `Ses Seviyesi: ${volume}`;
                document.getElementById('frequencyDisplay').textContent = `Frekans: ${Math.round(frequency)} Hz`;
                
                // Nota tespiti
                const note = detectNote(frequency);
                document.getElementById('noteDisplay').textContent = `Tahmini Nota: ${note}`;
                
                // Bir sonraki frame i√ßin devam et
                requestAnimationFrame(processAudio);
            }
            
            processAudio();
        }
        
        // NOTA TESPƒ∞Tƒ∞ (Basit algoritma)
        function detectNote(frequency) {
            if (frequency < 50) return '---';
            
            const notes = [
                { name: 'Do (C)', freq: 261.63 },
                { name: 'Do# (C#)', freq: 277.18 },
                { name: 'Re (D)', freq: 293.66 },
                { name: 'Re# (D#)', freq: 311.13 },
                { name: 'Mi (E)', freq: 329.63 },
                { name: 'Fa (F)', freq: 349.23 },
                { name: 'Fa# (F#)', freq: 369.99 },
                { name: 'Sol (G)', freq: 392.00 },
                { name: 'Sol# (G#)', freq: 415.30 },
                { name: 'La (A)', freq: 440.00 },
                { name: 'La# (A#)', freq: 466.16 },
                { name: 'Si (B)', freq: 493.88 }
            ];
            
            let closestNote = '---';
            let minDifference = Infinity;
            
            for (const note of notes) {
                const difference = Math.abs(frequency - note.freq);
                if (difference < minDifference) {
                    minDifference = difference;
                    closestNote = note.name;
                }
            }
            
            return closestNote;
        }
        
        // DURUM G√úNCELLEME
        function updateStatus(type, message) {
            const statusElement = document.getElementById('status');
            statusElement.className = `status ${type}`;
            statusElement.textContent = message;
        }
        
        // SAYFA Y√úKLENƒ∞NCE
        window.onload = function() {
            updateStatus('ready', 'üé∏ Akort aleti hazƒ±r! Mikrofonu ba≈ülat butonuna tƒ±kla.');
            
            // HTTPS kontrol√º
            if (location.protocol !== 'https:') {
                updateStatus('error', '‚ö†Ô∏è Mikrofon √ßalƒ±≈ümasƒ± i√ßin HTTPS gerekli!');
            }
        };
        
        // SAYFA KAPANIRKEN Mƒ∞KROFONU TEMƒ∞ZLE
        window.addEventListener('beforeunload', () => {
            stopListening();
        });
    </script>
</body>
</html>
